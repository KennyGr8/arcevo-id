// AUTO-GENERATED FILE. DO NOT EDIT MANUALLY
// Run: pnpm prisma:build-schema

ENUM ActivityType {
  LOGIN
  LOGOUT
  MFA_ENABLED
  PASSWORD_RESET
}

ENUM AdminAction {
  USER_BAN
  USER_UNBAN
  ACCOUNT_DELETED
  ORG_CREATED
  ORG_MEMBER_REMOVED
  ORG_INVITE_SENT
  SUBSCRIPTION_UPDATED
}

ENUM AuthEvent {
  LOGIN
  LOGOUT
  MFA_SUCCESS
  MFA_FAILED
  EMAIL_VERIFIED
  PASSWORD_CHANGED
  TOKEN_EXPIRED
}

ENUM BillingEventType {
  SUBSCRIPTION_CREATED
  SUBSCRIPTION_UPDATED
  SUBSCRIPTION_CANCELED
  PAYMENT_SUCCEEDED
  PAYMENT_FAILED
  TRIAL_STARTED
  TRIAL_ENDED
  REFUND_INITIATED
  COUPON_APPLIED
  PLAN_SWITCHED
  RENEWAL
  PROVIDER_SYNC
}

ENUM BillingProvider {
  STRIPE
  PAYSTACK
  LEMONSQUEEZY
}

ENUM OAuthProvider {
  GITHUB
  GOOGLE
  DISCORD
}

ENUM OrganizationRole {
  OWNER
  ADMIN
  MEMBER
  GUEST
}

ENUM Role {
  USER
  PREMIUM
  PRO
  ADMIN
}

ENUM SocialOAuthProvider {
	FACEBOOK
	LINKEDIN
}

ENUM SubscriptionPlan {
  FREE
  PREMIUM
  PRO
  ENTERPRISE
	EDUCATOR
}

ENUM SubscriptionProvider {
  STRIPE
  PAYSTACK
  LEMONSQUEEZY
}

ENUM SubscriptionStatus {
  ACTIVE
  CANCELED
  TRIALING
  EXPIRED
	RENEWED
}

ENUM TokenType {
  VERIFY_EMAIL
  RESET_PASSWORD
  MAGIC_LINK
  TOTP
}

ENUM UserStatus {
  ACTIVE
  SUSPENDED
  BANNED
}

ENUM Web3OAuthProvider {
	METAMASK
	BITCOIN
}

model ActivityLog {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  action    ActivityType
  ip        String?
  metadata  Json?
  userAgent String?
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

model AdminAuditLog {
  id        String   @id @default(uuid())
  action    AdminAction
  actorId   String?
  actor     User?    @relation("UserToAdminAuditLog", fields: [actorId], references: [id])
  target    String?
  meta      Json?
  createdAt DateTime @default(now())

  @@index([actorId])
  @@index([action])
  @@index([createdAt])
}

model AuthLog {
  id              String   @id @default(uuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id])
  event           AuthEvent
  ip              String?
  userAgent       String?
  platform        String?
  browser         String?
  locationCity    String?
  locationCountry String?
  createdAt       DateTime @default(now())

  @@index([userId])
  @@index([event])
  @@index([createdAt])
}

model BillingEvent {
  id             String               @id @default(uuid())
  userId         String
  user           User                 @relation(fields: [userId], references: [id])

  subscriptionId String
  subscription   Subscription         @relation(fields: [subscriptionId], references: [id])

  eventType      BillingEventType
  provider       SubscriptionProvider
  status         String?              // Optional result (e.g., "success", "failed", etc.)
  metadata       Json?                // Flexible provider-specific payload

  createdAt      DateTime             @default(now())

  @@index([userId])
  @@index([subscriptionId])
  @@index([eventType])
  @@index([createdAt])
}

model EmailToken {
  id        String    @id @default(uuid())
  email     String
  token     String    @unique
  type      TokenType
  expiresAt DateTime
  userId    String?
  user      User?     @relation(fields: [userId], references: [id])
  createdAt DateTime  @default(now())

  @@index([email])
  @@index([type])
  @@index([expiresAt])
}

model MFA {
  id          String            @id @default(uuid())
  userId      String            @unique
  user        User              @relation(fields: [userId], references: [id])
  secret      String
  enabled     Boolean           @default(false)
  verifiedAt  DateTime?
  createdAt   DateTime          @default(now())
  backupCodes MFA_BackupCode[]

  @@index([enabled])
}

model MFA_BackupCode {
  id     String   @id @default(uuid())
  code   String
  usedAt DateTime?
  mfaId  String
  mfa    MFA      @relation(fields: [mfaId], references: [id])

  @@index([mfaId])
  @@index([usedAt])
}

model OAuthAccount {
  id             String    @id @default(uuid())
  userId         String
  user           User      @relation(fields: [userId], references: [id])
  provider       OAuthProvider
  providerUserId String
  accessToken    String?
  refreshToken   String?
  expiresAt      DateTime?
  createdAt      DateTime  @default(now())

  @@unique([provider, providerUserId])
  @@index([userId])
  @@index([provider])
}

model OrganizationDomain {
  id             String        @id @default(uuid())
  organizationId String
  organization   Organization  @relation(fields: [organizationId], references: [id])
  domain         String        @unique
  verified       Boolean       @default(false)
}

model OrganizationInvite {
  id             String    @id @default(uuid())
  email          String
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  role           OrganizationRole @default(MEMBER)
  invitedById    String?
  invitedBy      User?       @relation("InviteInvitedBy", fields: [invitedById], references: [id])

  token          String     @unique
  expiresAt      DateTime
  acceptedAt     DateTime?
  createdAt      DateTime   @default(now())

  @@index([organizationId])
  @@index([email])
}

model OrganizationMembership {
  id             String        @id @default(uuid())
  userId         String
  user           User          @relation(fields: [userId], references: [id])

  organizationId String
  organization   Organization  @relation(fields: [organizationId], references: [id])

  role           OrganizationRole @default(MEMBER)
  invitedById    String?
  invitedBy      User?         @relation("MembershipInvitedBy", fields: [invitedById], references: [id])
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@unique([userId, organizationId])
}

model OrganizationSSOProvider {
  id               String     @id @default(uuid())
  organizationId   String
  organization     Organization @relation(fields: [organizationId], references: [id])
  provider         String
  ssoConfig        Json
  createdAt        DateTime   @default(now())

  @@index([organizationId])
}

model Organization {
  id          String        @id @default(uuid())
  name        String
  slug        String        @unique
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  memberships OrganizationMembership[]
  domains     OrganizationDomain[]
  invites     OrganizationInvite[]
  ssoProviders OrganizationSSOProvider[]
}

model Session {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id])
  ip              String?
  userAgent       String?
  deviceName      String?
  platform        String?
  browser         String?
  locationCity    String?
  locationCountry String?
  fingerprint     String?
  createdAt       DateTime  @default(now())
  lastActiveAt    DateTime? 
  expiresAt       DateTime
  valid           Boolean   @default(true)
  refreshToken    String? 

  firstSeenAt     DateTime? 
  lastUsedAt      DateTime? 

  @@index([userId])
  @@index([refreshToken])
  @@index([expiresAt])
  @@index([valid])
}

model Subscription {
  id                  String               @id @default(uuid())
  userId              String               @unique
  user                User                 @relation(fields: [userId], references: [id])

  plan                SubscriptionPlan
  status              SubscriptionStatus
  provider            SubscriptionProvider

  stripeCustomerId    String?
  stripeSubId         String?

  paystackCustomerId  String?
  paystackSubCode     String?

  lemonCustomerId     String?
  lemonOrderId        String?

  currentPeriodEnd    DateTime

  billingEvents BillingEvent[]

  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt

  @@index([plan])
  @@index([status])
  @@index([provider])
  @@index([currentPeriodEnd])
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String?
  name          String?
  emailVerified DateTime?
  role          Role      @default(USER)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  isDeactivated Boolean   @default(false)
  deletedAt     DateTime? 
  status        UserStatus @default(active)

  // Relations
  authLogs     AuthLog[]
  sessions     Session[]
  mfa          MFA?
  activityLogs ActivityLog[]
  accounts     OAuthAccount[]
  tokens       EmailToken[]
  subscription Subscription?
  auditLogs    AdminAuditLog[] @relation("UserToAdminAuditLog")

  organizationInvitesSent OrganizationInvite[] @relation("InviteInvitedBy")
  organizationMemberships OrganizationMembership[]
  organizationMembershipsInvited OrganizationMembership[] @relation("MembershipInvitedBy")

  billingEvents BillingEvent[]

  @@index([status])
  @@index([createdAt])
}
